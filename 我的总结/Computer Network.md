# Computer Network

#### 1. 计算机网络中，每一层都会添加额外的数据

1. **传输层比应用层多的数据结构**：
   - **源端口**和**目标端口：**用于标识发送方和接收方的应用程序。
   - **序列号**和**确认号**：用于实现可靠的数据传输。
   - **校验和**：用于检测数据在传输过程中是否被篡改。
2. **网络层比传输层多的数据结构**：
   - **IP地址**：包括源IP地址和目标IP地址，用于标识发送方和接收方的主机。
   - **标识**、**标志**和**片偏移**：用于分片和重组IP数据报。
   - **生存时间（TTL）**：用于防止数据包在网络中无限循环。
3. **数据链路层比网络层多的数据结构**：
   - 目标**MAC地址**和源MAC地址：用于标识发送方和接收方的网卡。
   - **帧起始标志**和**帧结束标志**：用于标识帧的开始和结束。
   - **帧校验序列**：用于检测帧在传输过程中是否出错。
4. **物理层比数据链路层多的数据结构**：
   - 电压、电流或光信号：用于在物理介质上传输数据。
   - **时钟信号**：用于同步发送方和接收方的数据传输速率。
   - **编码方式**：用于将数字数据转换为物理信号以在介质上传输。

#### 2. TCP vs UDP

|      | TCP                          | UDP                                  |
| ---- | ---------------------------- | ------------------------------------ |
|      | 面向连接                     | 无连接                               |
|      | 可靠传输，流量控制和拥塞管理 | 不可靠传输，不使用流量控制和拥塞管理 |
|      | 有序                         | 无序                                 |
|      | 传输速度慢                   | 传输速度快                           |
|      | 只支持一对一                 | 支持一对一、一对多和多对多           |
|      | 面向字节流                   | 面向报文                             |
|      | 首部开销小，固定8字节        | 首部最小20字节，最大60字节           |
|      | 适用于实时场景               | 适用于要求可靠传输的场景             |

- TCP首部结构：

  - **源端口 (16 bits)**：源端口号，标识发送方应用程序。

  - **目标端口 (16 bits)**：目标端口号，标识接收方应用程序。

  - **序列号 (32 bits)**：用于对TCP连接上发送的每个字节进行编号，用于实现可靠的数据传输。

  - **确认号 (32 bits)**：用于确认接收到的数据序列号，表明下一个期望接收的数据序列号。

  - **数据偏移 (4 bits)**：指示TCP首部的长度，以32位字（4字节）为单位，用于确定数据的起始位置。

  - **保留位 (6 bits)**：保留位，暂时没有使用，保留供将来使用。

  - **标志位 (6 bits)**：包括URG、ACK、PSH、RST、SYN和FIN，用于控制TCP连接状态。

  - **窗口大小 (16 bits)**：接收方窗口大小，用于流量控制。

  - **校验和 (16 bits)**：用于检测TCP首部和数据的完整性。

  - **紧急指针 (16 bits)**：当URG标志置位时，指示紧急数据的末尾位置。

  - **选项（最大40 bytes）**：可选字段，如最大段大小、时间戳等，用于提供额外的功能。

- UDP首部结构：

  - **源端口 (16 bits)**：源端口号，标识发送方应用程序。

  - **目标端口 (16 bits)**：目标端口号，标识接收方应用程序。

  - **长度 (16 bits)**：UDP数据报的长度，包括首部和数据部分。

  - **校验和 (16 bits)**：用于检测UDP数据报的完整性。

#### 3. TCP如何实现可靠传输

- 通过**序列号**和**确认应答信号**确保数据不会重复发送和重复接受
- 通过**超时重发**控制保证不出现数据丢失，保证数据完整性
- 通过**滑动窗口**控制提高数据传输效率

#### 4. 流量控制和拥塞控制的区别

- 流量控制的目标是确保发送方和接收方之间数据传输保持适当的速率，以防止接收方无法及时处理和接受数据从而导致**数据丢失**或**溢出**。
- 拥塞控制的目标是确保网络中的数据流量不超过网络的容量，以防止**网络拥塞**和**性能下降**。
- 流量控制主要关注发送方和接收方之间的数据传输速率，以**保持二者之间的平衡**；而拥塞控制则更广泛地关注整个网络中的数据流量，以**避免网络拥塞和性能下降**。

#### 5. 滑动窗口机制

1. **发送窗口（Sender Window）**：

   - 发送方维护一个发送窗口，表示**可以发送但还未收到确认的数据序列号范围**。发送窗口的大小由**接收方的窗口大小**和**网络状况**决定。

     <img src="/Users/chocolate/Documents/project/call4jobs/我的总结/发送窗口.png" style="zoom:67%;" />

2. **接收窗口（Receiver Window）**：

   - 接收方维护一个接收窗口，表示**可以接收但还未收到的数据序列号范围**。接收窗口的大小由接收方的应用程序处理速度、**可用缓冲区大小**等因素决定。

     <img src="/Users/chocolate/Documents/project/call4jobs/我的总结/接受窗口.png" alt="接受窗口" style="zoom:67%;" />

3. **流量控制**：

   - 发送方根据接收方的接收窗口大小来控制发送的数据量，以防止发送方发送过多的数据导致接收方缓冲区溢出。
   - 发送方将发送窗口内的数据发送给接收方，并等待接收方的确认。

4. **滑动**：

   - 发送方通过滑动发送窗口的起始序列号来动态调整发送窗口的大小。
   - 当发送方收到接收方对于某个数据的确认后，发送窗口向前滑动，表示之前的数据已经被接收方成功接收。

5. **确认**：

   - 接收方发送确认消息给发送方，确认已经成功接收到数据。确认消息中包含了接收方期望接收的下一个数据的序列号，这个序列号会触发发送方滑动窗口。

#### 6. 拥塞控制

TCP 拥塞控制算法主要包括以下几种：

1. **慢启动（Slow Start）**：

   - 在 TCP 连接刚建立时，发送方会以**指数增长**的方式增加发送窗口的大小，从而快速占用网络资源。
   - 发送方每收到一个 ACK 确认，就将发送窗口的大小**加倍**，直到达到**慢启动门限**（Slow Start Threshold）为止。

2. **拥塞避免（Congestion Avoidance）**：

   - 一旦发送方的窗口大小达到慢启动门限，就进入拥塞避免阶段。
   - 在拥塞避免阶段，发送方每经过一个往返时间（RTT），窗口大小增加一个 MSS（最大报文段长度），实现**线性增长**。

3. **快速重传（Fast Retransmit）**：

   - 当发送方连续收到**相同的 ACK 确认**时，表明某个报文段丢失，可以快速重传该丢失的报文段，而无需等待超时重传的定时器触发。

4. **快速恢复（Fast Recovery）**：

   - 在快速重传之后，发送方会将慢启动门限设置为**当前窗口大小的一半**，并将拥塞窗口大小设置为**慢启动门限**，而不是重置为 1 个 MSS。

   - 发送方继续以线性增长的方式增加拥塞窗口的大小，直到达到慢启动门限为止。

     <img src="/Users/chocolate/Documents/project/call4jobs/我的总结/快速恢复.jpeg" alt="快速恢复" style="zoom:80%;" />

5. **超时重传（Timeout Retransmission）**：

   - 如果发送方在超时时间内未收到 ACK 确认，则会认为某个报文段丢失，触发超时重传机制，重新发送该报文段。

#### 7. 什么是慢开始门限

慢开始：如果立即将大量的数据注入到网络中，可能会出现网络的拥塞。因此不要一开始就发送大量的数据，应**由小到大逐渐增加拥塞窗口的大小**。

